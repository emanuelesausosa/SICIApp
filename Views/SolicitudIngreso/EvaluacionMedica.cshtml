@model SICIApp.Entities.INGRESO

@{
    ViewBag.Title = "Evaluación Médica";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-sm-4">
        <h2>Project detail</h2>
        <ol class="breadcrumb">
            <li>
                <a href="@Url.Action("Dashboard_1", "Dashboards")">Home</a>
            </li>
            <li class="active">
                <strong>Project detail</strong>
            </li>
        </ol>
    </div>
</div>
<div class="row">
    <div class="wrapper wrapper-content animated fadeInUp">
        <div class="ibox">
            <div class="ibox-content">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="m-b-md">
                            <button type="button" id="new-insert" data-id="@Model.ID" class="btn btn-primary btn-sm pull-right" data-toggle="modal" data-target="#myModal2">
                                FINALIZAR Y PROCESAR
                            </button>
                            <div class="modal inmodal" id="myModal2" tabindex="-1" role="dialog" aria-hidden="true">
                                <div class="modal-dialog" id="new-insert-container">
                                    <div class="modal-content animated flipInY" id="new-insert-diag">
                                    </div>
                                </div>
                            </div>
                            <h2>Evaluación Médica de <strong >@Model.FICHA.PRIMERNOMBRE @Model.FICHA.PRIMERAPELLIDO</strong></h2>
                        </div>
                        <dl class="dl-horizontal">
                            <dt>Status:</dt>
                            @if (Model.ACEPTADO == true)
                            {
                                <dd><span class="label label-primary">Aceptado</span></dd>
                            }
                            else
                            {
                                <dd><span class="label label-warning">En proceso</span></dd>
                            }


                        </dl>
                    </div>
                </div>
                <div class="row">
                    <dl class="dl-horizontal">

                        <dt>Nombre del paciente:</dt>
                        <dd>@Model.FICHA.PRIMERNOMBRE @Model.FICHA.SEGUNDONOMBRE @Model.FICHA.PRIMERAPELLIDO @Model.FICHA.SEGUNDOAPELLIDO</dd>
                        <dt>Cógigo ingreso:</dt>
                        <dd id="@Model.ID">@Model.ID</dd>
                        <dt>Client:</dt>
                        <dd><a href="#" class="text-navy"> Zender Company</a> </dd>
                        <dt>Version:</dt>
                        <dd> 	v1.4.2 </dd>
                    </dl>
                    <div class="col-lg-7" id="cluster_info">
                        <dl class="dl-horizontal">

                            <dt>Last Updated:</dt>
                            <dd>16.08.2014 12:15:57</dd>
                            <dt>Created:</dt>
                            <dd> 	10.07.2014 23:36:57 </dd>
                            <dt>Participants:</dt>
                            <dd class="project-people">
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a3.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a1.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a2.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a4.jpg"></a>
                                <a href=""><img alt="image" class="img-circle" src="~/Images/a5.jpg"></a>
                            </dd>
                        </dl>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <dl class="dl-horizontal">
                            <dt>Completed:</dt>
                            <dd>
                                <div class="progress progress-striped active m-b-sm">
                                    <div style="width: 60%;" class="progress-bar"></div>
                                </div>
                                <small>Project completed in <strong>60%</strong>. Remaining close the project, sign a contract and invoice.</small>
                            </dd>
                        </dl>
                    </div>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Signos vitales<small class="m-l-sm">Evaluación Médica</small></h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>                            
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class="row">

                            <div class="form-horizontal">
                                <form role="form" id="form">
                                    <div class="form-group">
                                        <label class="control-label col-md-2">Peso (Lb)</label>
                                        <div class="col-md-10">
                                            <input id="em-peso" type="text" placeholder="peso en libras (Lb)" class="form-control" name="numero">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-2">Presion arterial</label>
                                        <div class="col-md-10">
                                            <input id="em-presion" type="text" placeholder="Presión arterial" class="form-control" name="numero">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-2">Frecuencia cardiaca</label>
                                        <div class="col-md-10">
                                            <input id="em-frecuencia" type="text" placeholder="Frecuencia cardiaca" class="form-control" name="numero">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-offset-2 col-md-10">
                                            <input id="save-em-sv" type="button" value="Guardar" class="btn btn-primary" data-id="@Model.ID" />
                                        </div>
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>
                    <div class="ibox-footer">
                        <span class="pull-right">
                            The righ side of the footer
                        </span>
                        This is simple footer example
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Aparatos y sistemas<small class="m-l-sm">Evaluación médica</small></h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="tabs-container">
                                    <ul class="nav nav-tabs">

                                        @{int c = 0;}


                                        @foreach (var item in Model.APARATOSSISTEMAS)
                                        {
                                            if (c == 0)
                                            {
                                                c++;
                                                <li class="active"><a data-toggle="tab" href="#tab-@c">@item.APARATOSSISTEMAS_SISTEMAS.NOMBRE</a></li>
                                            }
                                            else
                                            {
                                                c++;
                                                <li class=""><a data-toggle="tab" href="#tab-@c">@item.APARATOSSISTEMAS_SISTEMAS.NOMBRE</a></li>
                                            }
                                        }
                                        @{c = 0;}

                                    </ul>
                                    <div class="tab-content">
                                        @foreach (var item in Model.APARATOSSISTEMAS)
                                        {
                                            if (c == 0)
                                            {
                                                c++;
                                                <div id="tab-@c" class="tab-pane active">
                                                    <div class="panel-body">
                                                        <div class="row">
                                                            <form role="form" id="form2" class="update" data-idingreso="@item.IDINGRESO" data-idsistema="@item.IDAPARATOSISTEMA">

                                                                <div class="row">
                                                                    <div class="col-lg-12">
                                                                        <div class="form-group">
                                                                            <label>@item.APARATOSSISTEMAS_SISTEMAS.NOMBRE</label>
                                                                            <textarea id="CONDICIONFAMILIAR" form="form2" data-desc="@item.DIAGNOSTICO" name="@item.APARATOSSISTEMAS_SISTEMAS.NOMBRE" class="summernote">
                                                                                @item.DIAGNOSTICO
                                                                            </textarea>
                                                                            <div class="col-md-offset-2 col-md-10">
                                                                                <input id="save-em-as" data-idingreso="@Model.ID" data-idsistema="@item.IDAPARATOSISTEMA" type="button" value="Guardar" class="btn-update" />
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <hr />
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                c++;
                                                <div id="tab-@c" class="tab-pane">
                                                    <div class="panel-body">
                                                        <div class="row">
                                                            <form role="form" id="form2" class="update" data-idingreso="@item.IDINGRESO" data-idsistema="@item.IDAPARATOSISTEMA">

                                                                <div class="row">
                                                                    <div class="col-lg-12">
                                                                        <div class="form-group">
                                                                            <label>@item.APARATOSSISTEMAS_SISTEMAS.NOMBRE</label>
                                                                            <textarea id="CONDICIONFAMILIAR" form="form2" data-desc="@item.DIAGNOSTICO" name="@item.APARATOSSISTEMAS_SISTEMAS.NOMBRE" class="summernote">
                                                                                @item.DIAGNOSTICO
                                                                            </textarea>
                                                                            <div class="col-md-offset-2 col-md-10">
                                                                                <input id="save-em-as" data-idingreso="@Model.ID" data-idsistema="@item.IDAPARATOSISTEMA" type="button" value="Guardar" class="btn-update" />
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <hr />


                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ibox-footer">
                        <span class="pull-right">
                            The righ side of the footer
                        </span>
                        This is simple footer example
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Evaluaciones generales<small class="m-l-sm">Evaluación médica</small></h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="tabs-container">
                                    <ul class="nav nav-tabs">

                                        @{int i = 10;}


                                        @foreach (var item in Model.EVALUACIONMEDICADETALLE)
                                        {
                                            if (i == 10)
                                            {
                                                i++;
                                                <li class="active"><a data-toggle="tab" href="#tab-@i">@item.TIPOEVALUACIONMEDICA.CATEGORIA</a></li>
                                            }
                                            else
                                            {
                                                i++;
                                                <li class=""><a data-toggle="tab" href="#tab-@i">@item.TIPOEVALUACIONMEDICA.CATEGORIA</a></li>
                                            }
                                        }
                                        @{i = 10;}

                                    </ul>
                                    <div class="tab-content">
                                        @foreach (var item in Model.EVALUACIONMEDICADETALLE)
                                        {
                                            if (i == 10)
                                            {
                                                i++;
                                                <div id="tab-@i" class="tab-pane active">
                                                    <div class="panel-body">
                                                        <div class="row">
                                                            <form role="form" id="form2" class="update" data-idingreso="@item.IDINGRESO" data-idsistema="@item.IDTIPOEVALUACIONMEDICA">

                                                                <div class="row">
                                                                    <div class="col-lg-12">
                                                                        <div class="form-group">
                                                                            <label>@item.TIPOEVALUACIONMEDICA.CATEGORIA</label>
                                                                            <textarea id="CONDICIONFAMILIAR" form="form2" data-desc="@item.OBSERVACIONES" name="@item.TIPOEVALUACIONMEDICA.CATEGORIA" class="summernote">
                                                                                @item.OBSERVACIONES
                                                                            </textarea>
                                                                            <div class="col-md-offset-2 col-md-10">
                                                                                <input id="save-em-as" data-idingreso="@Model.ID" data-iddetalle="@item.IDTIPOEVALUACIONMEDICA" type="button" value="Guardar" class="btn" />
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <hr />
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                i++;
                                                <div id="tab-@i" class="tab-pane">
                                                    <div class="panel-body">
                                                        <div class="row">
                                                            <form role="form" id="form2" class="update" data-idingreso="@item.IDINGRESO" data-idsistema="@item.IDTIPOEVALUACIONMEDICA">

                                                                <div class="row">
                                                                    <div class="col-lg-12">
                                                                        <div class="form-group">
                                                                            <label>@item.TIPOEVALUACIONMEDICA.CATEGORIA</label>
                                                                            <textarea id="CONDICIONFAMILIAR" form="form2" data-desc="@item.OBSERVACIONES" name="@item.TIPOEVALUACIONMEDICA.CATEGORIA" class="summernote">
                                                                                @item.OBSERVACIONES
                                                                            </textarea>
                                                                            <div class="col-md-offset-2 col-md-10">
                                                                                <input id="save-em-as" data-idingreso="@Model.ID" data-iddetalle="@item.IDTIPOEVALUACIONMEDICA" type="button" value="Guardar" class="btn" />
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <hr />
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ibox-footer">
                        <span class="pull-right">
                            The righ side of the footer
                        </span>
                        This is simple footer example
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

@section Styles {
    @Styles.Render("~/plugins/summernoteStyles")
    @Styles.Render("~/plugins/toastrStyles")

}

@section Scripts {
    @Scripts.Render("~/plugins/summernote")
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/plugins/toastr")
    @Scripts.Render("~/plugins/validate")

    <script type="text/javascript">
        $(document).ready(function () {
            $('.summernote').summernote();

            $('#new-insert').click(function () {
                var url = "/SolicitudIngreso/ProcesarSolicitudAlterna";
                var ID = $(this).attr('data-id');
                $.get(url + '/' + ID, function (data) {
                    $('#new-insert-diag').html(data);
                    $('#myModal2').modal('show');
                });
            });

            $("#form").validate({
                rules: {
                    password: {
                        required: true,
                        minlength: 3
                    },
                    url: {
                        required: true,
                        url: true
                    },
                    numero: {
                        required: false,
                        number: true
                    },
                    number: {
                        required: true,
                        number: true
                    },
                    min: {
                        required: true,
                        minlength: 6
                    },
                    max: {
                        required: true,
                        maxlength: 4
                    }
                }
            });

        });

        $('#save-em-sv').click(function () {

            var element = this;
            var _model = {
                idingreso: $(this).attr('data-id'),
                peso: $('#em-peso').val(),
                frecuenciacardiaca: $('#em-frecuencia').val(),
                presionarterial: $('#em-presion').val()


            }

            toastr.info('Procesando', 'se ha procesado la solicitud');

            $.ajax({
                url: '/SolicitudIngreso/GuardarEvaluacionSignosVitales',
                type: 'post',
                contentType: 'application/json; charset=utf-8',
                processData: false,
                datatype: 'json',
                data: JSON.stringify(_model),
                success: function (data) {
                    if (data.success) {
                        toastr.success(data.message, 'Éxito');
                    }
                    else {
                        toastr.warning(data.message, 'Alerta');
                    }

                },
                error: function (req, status, err) {
                    toastr.error(data.message, 'Error');
                },
                async: true,
                processData: false
            });
        });

        $(function () {
            $('.btn-update').click(function () {
                var element = this;


                var _model = {
                    idingreso: $(this).attr('data-idingreso'),
                    idaparatosistema: $(this).attr('data-idsistema'),
                    diagnostico: $(this).parent().prevAll('.summernote').code().trim()
                }

                toastr.info('Procesando', 'se ha procesado la solicitud');

                $.ajax({
                    url: '/SolicitudIngreso/GuardarAparatosSistemas',
                    type: 'post',
                    contentType: 'application/json; charset=utf-8',
                    processData: false,
                    datatype: 'json',
                    data: JSON.stringify(_model),
                    success: function (data) {
                        if (data.success) {
                            toastr.success(data.message, 'Éxito');
                        }
                        else {
                            toastr.warning(data.message, 'Alerta');
                        }

                    },
                    error: function (req, status, err) {
                        toastr.error(data.message, 'Error');
                    },
                    async: true,
                    processData: false
                });
            });
        });
        $(function () {
            $('.btn').click(function () {
                var element = this;
                
                var _model = {
                    idingreso: $(this).attr('data-idingreso'),                    
                    idtipoevaluacionmedica: $(this).attr('data-iddetalle'),
                    observaciones: $(this).parent().prevAll('.summernote').code().trim()
                }

                // mesaje de procesamiento
                toastr.info('Procesando', 'se ha procesado la solicitud');

                $.ajax({
                    url: '/SolicitudIngreso/GuardarEvaluacionMedicaDetalle',
                    type: 'post',
                    contentType: 'application/json; charset=utf-8',
                    processData: false,
                    datatype: 'json',
                    data: JSON.stringify(_model),
                    success: function (data) {
                        if (data.success) {
                            toastr.success(data.message, 'Éxito');
                        }
                        else {
                            toastr.warning(data.message, 'Alerta');
                        }

                    },
                    error: function (req, status, err) {
                        toastr.error(data.message, 'Error');
                    },
                    async: true,
                    processData: false

                });
            });
        });
        //$("form").submit(function () {
        //    var element = this;


        //    var _model = {
        //        idingreso: $(this).attr('data-idingreso'),
        //        idaparatosistema: $(this).attr('data-idsistema'),
        //        diagnostico: $('textarea#CONDICIONFAMILIAR').code()
        //    }

        //    toastr.info('Procesando', 'se ha procesado la solicitud');

        //    $.ajax({
        //        url: '/SolicitudIngreso/GuardarAparatosSistemas',
        //        type: 'post',
        //        contentType: 'application/json; charset=utf-8',
        //        processData: false,
        //        datatype: 'json',
        //        data: JSON.stringify(_model),
        //        success: function (data) {
        //            if (data.success) {
        //                toastr.success(data.message, 'Éxito');
        //            }
        //            else {
        //                toastr.warning(data.message, 'Alerta');
        //            }

        //        },
        //        error: function (req, status, err) {
        //            toastr.error(data.message, 'Error');
        //        },
        //        async: true,
        //        processData: false
        //    });


        //});

    </script>
}